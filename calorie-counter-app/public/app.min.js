!function(){var e=angular.module("app",["ui.router","ngCookies"]);e.constant("API_ROUTE","http://127.0.0.1:8000"),e.config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]),e.config(["$stateProvider",function(e){var t={index:{url:"/index",templateUrl:"/home.html",controller:"HomeController"},login:{url:"/login",templateUrl:"/login.html",controller:"LoginController"},signup:{url:"/signup",templateUrl:"/signup.html",controller:"SignupController"},logout:{url:"/logout",templateUrl:"/logout.html",controller:"LogoutController"},dashboard:{url:"/dashboard",templateUrl:"/dashboard.html",controller:"DashboardController"}};angular.forEach(t,function(t,o){e.state(o,t)})}]),e.factory("AuthInterceptor",["TokenService",function(e){return{request:function(t){var o=e.getAccessToken();return o&&(t.headers.Authorization="Bearer "+o),t}}}]),e.factory("TokenService",["$cookieStore",function(e){var t="";return{getAccessToken:function(){return t},setAccessToken:function(o){return e.put("x-access-token",o),t=o,this},loadFromCookie:function(){return t=e.get("x-access-token"),this},deleteAccessToken:function(){return e.remove("x-access-token"),this},checkIsAuthenticated:function(){return""!==t}}}]),e.controller("DashboardController",["$scope","IntakesService","TokenService","$state","UserService",function(e,t,o,n,r){function i(e){var t=0;return e.forEach(function(e){t+=e.calories}),t}e.rangeDate={from:"",to:""},e.rangeTime={from:"",to:""},e.moment=moment,e.intakes=[],e.newIntake={name:"",calories:"",time:"",date:""},e.todayCalories=0,e.todayIntakes=[],e.user={id:"",email:"",role:"",name:"",goalCalories:0},e.init=function(){var t=o.getAccessToken();return t?(e.getUser(),e.getIntakes(),void 0):(n.go("login"),void 0)},e.getIntakes=function(){t.get().then(function(o){e.intakes=o,e.todayIntakes=t.filter(o,function(e){return 0===moment().diff(e.consumedAt,"days")}),e.todayCalories=i(e.todayIntakes)})},e.getUser=function(){r.get().then(function(t){e.user=t})},e.onAddNewIntake=function(o){t.post(o.name,o.calories,moment()).then(function(){e.getIntakes(),e.newIntake={name:"",calories:""}})},e.dateFilter=function(e,t){return function(o){var n=moment(o.createdAt),r=!0;return""!==e&&n.isBefore(e,"day")&&(r=!1),""!==t&&n.isAfter(t,"day")&&(r=!1),r}},e.timeFilter=function(e,t){return toHours=function(e){return e.minutes()+60*e.hours()},function(o){var n=moment(o.createdAt).format("HH:mm"),r=!0;return""!==e&&e>n&&(console.log("is before"),r=!1),""!==t&&n>t&&(console.log("is after"),r=!1),r}},e.formatDate=function(e){return moment().diff(e,"hours")<24?moment(e).startOf("minute").fromNow():moment(e).format("YYYY-MM-DD [at] hh:mm A")}}]),e.factory("FooService",["$http",function(e){return{getFoo:function(){return e.get("/foo").then(function(e){return e.data})}}}]),e.controller("HomeController",["$scope",function(e){e.awesome=!0}]),e.factory("IntakesService",["$http","API_ROUTE",function(e,t){function o(e){return e}return{get:function(){return e.get(t+"/v1/intakes").then(function(e){return e.data.intakes})},post:function(o,n,r){var i={name:o,calories:parseInt(n,10),consumedAt:r};return e.post(t+"/v1/intakes",i)},filter:function(e,t){return e.filter(t||o)}}}]),e.controller("LoginController",["$scope","$state","LoginService","TokenService",function(e,t,o,n){e.user={username:"",passwd:""},e.init=function(){var e=n.loadFromCookie().getAccessToken();e&&t.go("dashboard")},e.onLogin=function(n){o.postLogin(n.username,n.passwd).then(function(){t.go("dashboard"),e.user={name:"",passwd:""}})}}]),e.factory("LoginService",["$http","API_ROUTE","TokenService",function(e,t,o){return{postLogin:function(n,r){var i={email:n,password:r};return e.post(t+"/auth/login",i).then(function(e){o.setAccessToken(e.data.accessToken)})}}}]),e.controller("LogoutController",["$scope","TokenService","LogoutService",function(e,t,o){e.onLogout=o.onLogout}]),e.factory("LogoutService",["$http","API_ROUTE","TokenService","$state","$rootScope",function(e,t,o,n,r){return{onLogout:function(){o.deleteAccessToken(),n.go("index"),$scope.$$phase||r.$digest()}}}]),e.controller("PageController",["$scope","TokenService","$state","LogoutService",function(e,t,o,n){e.isAuthenticated=function(){return t.checkIsAuthenticated()},e.signup=function(){console.log("signup"),o.go("signup")},e.login=function(){console.log("login"),o.go("login")},e.settings=function(){console.log("settings"),o.go("settings")},e.logout=function(){console.log("logout"),n.onLogout()}}]),e.controller("SignupController",["$scope","$state","SignupService","TokenService",function(e,t,o,n){e.user={username:"",name:"",passwd:"",goalCalories:""},e.init=function(){var e=n.loadFromCookie().getAccessToken();e&&t.go("dashboard")},e.onSignup=function(n){o.postSignup(n.username,n.name,n.passwd,n.goalCalories).then(function(){e.user={username:"",name:"",passwd:"",goalCalories:""},t.go("dashboard")})}}]),e.factory("SignupService",["$http","API_ROUTE","TokenService",function(e,t,o){return{postSignup:function(n,r,i,c){var a={email:n,name:r,password:i,goalCalories:parseInt(c,10)};return e.post(t+"/auth/signup",a).then(function(e){o.setAccessToken(e.data.accessToken)})}}}]),e.factory("UserService",["$http","API_ROUTE",function(e,t){return{get:function(){return e.get(t+"/v1/users").then(function(e){return e.data})}}}])}();